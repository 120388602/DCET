-- Generated by CSharp.lua Compiler
local System = System
local DCETHotfix = DCET.Hotfix
System.namespace("DCET.Hotfix", function (namespace)
  namespace.class("MapHelper", function (namespace)
    local EnterMapAsync
    EnterMapAsync = function (sceneName)
      System.async(function (async, sceneName)
        System.try(function ()
          -- 加载Unit资源
          local resourcesComponent = DCETHotfix.Game.getScene():GetComponent(DCETHotfix.ResourcesComponent)
          async:await(resourcesComponent:LoadBundleAsync("unit.unity3d" .. ""))

          -- 加载场景资源
          async:await(DCETHotfix.Game.getScene():GetComponent(DCETHotfix.ResourcesComponent):LoadBundleAsync("map.unity3d"))
          -- 切换到map场景
          System.using(DCETHotfix.Game.getScene():AddComponent(DCETHotfix.SceneChangeComponent), function (sceneChangeComponent)
            async:await(sceneChangeComponent:ChangeSceneAsync(sceneName))
          end)

          local g2CEnterMap = System.as(async:await(DCETHotfix.SessionComponent.Instance:getSession():Call(DCETHotfix.C2G_EnterMap())), DCETHotfix.G2C_EnterMap)
          DCETHotfix.PlayerComponent.Instance:getMyPlayer().UnitId = g2CEnterMap:getUnitId()

          DCETHotfix.Game.getScene():AddComponent(DCETHotfix.OperaComponent)

          DCETHotfix.Game.getEventSystem():Run("EnterMapFinish" --[[EventIdType.EnterMapFinish]])
        end, function (default)
          local e = default
          DCETHotfix.Log.Error(e)
        end)
      end, true, sceneName)
    end
    return {
      EnterMapAsync = EnterMapAsync
    }
  end)
end)

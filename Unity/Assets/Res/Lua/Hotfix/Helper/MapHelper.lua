-- Generated by CSharp.lua Compiler
local System = System
local DCET = DCET
local DCET
System.import(function (out)
  DCET = out.DCET
end)
System.namespace("DCET", function (namespace)
  namespace.class("MapHelper", function (namespace)
    local EnterMapAsync
    EnterMapAsync = function (sceneName)
      System.async(function (async, sceneName)
        System.try(function ()
          -- 加载Unit资源
          local resourcesComponent = DCET.Game.getScene():GetComponent(DCET.ResourcesComponent)
          async:await(resourcesComponent:LoadBundleAsync("unit.unity3d" .. ""))

          -- 加载场景资源
          async:await(DCET.Game.getScene():GetComponent(DCET.ResourcesComponent):LoadBundleAsync("map.unity3d"))
          -- 切换到map场景
          System.using(DCET.Game.getScene():AddComponent(DCET.SceneChangeComponent), function (sceneChangeComponent)
            async:await(sceneChangeComponent:ChangeSceneAsync(sceneName))
          end)

          local g2CEnterMap = System.as(async:await(DCET.SessionComponent.Instance:getSession():Call(DCET.C2G_EnterMap())), DCET.G2C_EnterMap)
          DCET.PlayerComponent.Instance:getMyPlayer().UnitId = g2CEnterMap:getUnitId()

          DCET.Game.getScene():AddComponent(DCET.OperaComponent)

          DCET.Game.getEventSystem():Run("EnterMapFinish" --[[EventIdType.EnterMapFinish]])
        end, function (default)
          local e = default
          DCET.Log.Error(e)
        end)
      end, true, sceneName)
    end
    return {
      EnterMapAsync = EnterMapAsync
    }
  end)
end)

-- Generated by CSharp.lua Compiler
local System = System
local UnityEngine = UnityEngine
local ListVector3 = System.List(UnityEngine.Vector3)
local DCETHotfix
System.import(function (out)
  DCETHotfix = DCET.Hotfix
end)
System.namespace("DCET.Hotfix", function (namespace)
  namespace.class("UnitPathComponent", function (namespace)
    local StartMove, __ctor__
    __ctor__ = function (this)
      this.Path = ListVector3()
      this.ServerPos = System.default(UnityEngine.Vector3)
      System.base(this).__ctor__(this)
    end
    StartMove = function (this, cancellationToken)
      return System.async(function (async, this, cancellationToken)
        for i = 0, #this.Path - 1 do
          local v = this.Path:get(i)

          local speed = 5

          if i == 0 then
            -- 矫正移动速度
            local clientPos = this:GetParent(DCETHotfix.Unit):getPosition()
            local serverf = (this.ServerPos - v):getmagnitude()
            if serverf > 0.1 then
              local clientf = (clientPos - v):getmagnitude()
              speed = clientf / serverf * speed
            end
          end

          this:getParent():GetComponent(DCETHotfix.TurnComponent):Turn(v:__clone__(), 0.100000001)
          async:await(this:getParent():GetComponent(DCETHotfix.MoveComponent):MoveToAsync(v:__clone__(), speed, cancellationToken))
        end
      end, nil, this, cancellationToken)
    end
    return {
      base = function (out)
        return {
          out.DCET.Hotfix.Entity
        }
      end,
      StartMove = StartMove,
      __ctor__ = __ctor__
    }
  end)
end)
